{
  "hash": "9b4bf99e744b748767927e835156e67e",
  "result": {
    "markdown": "---\ntitle: \"Pirámides de población en R-Studio para entender la estructura por edad y sexo de la población migrante en los Estados Unidos (2021)\"\nauthor: \"Francisco Reyes-Vázquez\"\ndate: \"2028-05-31\"\ncategories: [R, ACS, Migración, Pirámides de Población]\nimage: \"cover.png\"\ntoc: true\ntoc-depth: 5\ntoc-title: Contenido\n---\n\n\n\n\n# Introducción\n\nLas pirámides de población son herramientas gráficas que permiten observar la estructura por edad y sexo de una población. Se componen de dos histogramas invertidos que expresan el porcentaje de personas que hay en cada edad según su sexo. Además, cabe agregar que las pirámides de población tienen la capacidad de proporcionar información valiosa sobre el comportamiento de la fecundidad, la mortalidad y la esperanza de vida de una población. En esta ocasión utilizaremos datos de la [*American Community Survey* (ACS, 2021)](https://www.census.gov/programs-surveys/acs) para construir las pirámides de población de la población en Estados Unidos por país de nacimiento.\n\nLa `ACS` es una encuesta continua que brinda información anual y actualizada sobre Estados Unidos y su población. Actualmente, cuenta con un tamaño de muestra de alrededor de 3 millones de direcciones postales, razón por lo que es considerada la encuesta en hogares más grande de los Estados Unidos. Esta tiene representatividad a nivel nacional, por estados, ciudades y condados con 65 mil habitantes o más. Gracias a la `ACS` es posible tener datos actualizados sobre diferentes temas sociales, económicos y demográficos, mismos que ayudan a determinar la distribución de fondos federales y estatales en Estados Unidos.\n\n# Importar y limpiar los datos\n\nAntes de comenzar, vamos a activar las librerías que vamos a utilizar a lo largo de este proyecto. Seguidamente utilizaremos la función `get_pums()` del paquete `tidycensus` para traer los datos de la `ACS` directamente del repositorio en el que se encuentran. La función se configurará de tal manera que nos permita extraer exclusivamente las variables de interés relativas a la población de los Estados Unidos reportada en la versión anual de la `ACS` para el 2021. La función `get_pums()` es completamente funcional, pero si se detecta algún problema en la descargar, se recomida obtener una `API KEY` registrándose en la página del Censo ( https://api.census.gov/data/key_signup.html) e ingresarla en la función `census_api_key()` para darla de alta.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidycensus)\nlibrary(tidyverse)\nlibrary(reactable)\nlibrary(survey)\nlibrary(showtext)\nlibrary(geofacet)\nlibrary(tinter)\nlibrary(RColorBrewer)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncensus_api_key(\"API KEY\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- get_pums(\n  variables = c(\"ST\",\"SEX\", \"AGEP\", \"POBP\"),\n  state = \"all\",\n  survey = \"acs1\",\n  year = 2021,\n  recode = TRUE)\n```\n:::\n\n::: {.cell}\n\n:::\n\n\nAl utilizar la función `glimpse` para explorar los datos, podemos observar que el conjunto de datos se compone de 3,252,599 observaciones y 11 columnas. Al analizar su estructura podemos identificar que cada una de las observaciones equivale a una persona y cada variable corresponde a las características de esas personas. La descripción de las variables se muestra a continuación:\n\n1.  `SERIALNO`, identificador que se compone del número de unidad de la vivienda y de la persona\n2.  `SPORDER`, identificador de la persona\n3.  `WGTP`, ponderador de la vivienda\n4.  `PWGTP`, ponderador de la persona\n5.  `AGEP`, edad de la persona\n6.  `ST`, estado de residencia\n7.  `SEX`, sexo de la persona\n8.  `POBP`, país de nacimiento\n9.  `ST_label`, etiqueta del estado de residencia\n10. `SEX_label`, etiqueta del sexo de la persona\n11. `POBP_label`, etiqueta del país de nacimiento\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 3,252,599\nColumns: 11\n$ SERIALNO   <chr> \"2021GQ0000026\", \"2021GQ0000031\", \"2021GQ0000063\", \"2021GQ0…\n$ SPORDER    <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…\n$ WGTP       <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ PWGTP      <int> 13, 51, 17, 61, 15, 46, 55, 31, 71, 48, 76, 31, 20, 106, 19…\n$ AGEP       <int> 85, 67, 74, 16, 83, 19, 36, 35, 45, 20, 27, 19, 85, 30, 34,…\n$ ST         <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…\n$ SEX        <int> 1, 2, 1, 1, 1, 2, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 1, 2, 1, 2,…\n$ POBP       <int> 1, 1, 1, 47, 1, 53, 1, 1, 1, 13, 1, 22, 22, 12, 18, 1, 36, …\n$ ST_label   <chr> \"Alabama/AL\", \"Alabama/AL\", \"Alabama/AL\", \"Alabama/AL\", \"Al…\n$ SEX_label  <chr> \"Male\", \"Female\", \"Male\", \"Male\", \"Male\", \"Female\", \"Male\",…\n$ POBP_label <chr> \"Alabama/AL\", \"Alabama/AL\", \"Alabama/AL\", \"Tennessee/TN\", \"…\n```\n:::\n:::\n\n\nAhora bien, nos vamos a concentrar en las variables de interés, y vamos a explorarlas con la función `table()` y transformarlas según sea necesario. Las variables necesarias para construir la pirámide de población de los Estados Unidos son la edad y el sexo, por lo que, primero será necesario trasformar la variable`AGEP`en grupos quinquenales de edad con la función `mutate()` y vamos a colocar el resultado en una nueva variable que llamaremos `AGEP2`. Posteriormente exploraremos la variable `SEX_label` que ya se encuentra óptima y no será necesario transformar.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Explorar variable de edad \ntable(data$AGEP, useNA = \"always\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n    0     1     2     3     4     5     6     7     8     9    10    11    12 \n28072 29480 30556 31689 32041 33345 34197 34518 34301 34813 35936 36335 37265 \n   13    14    15    16    17    18    19    20    21    22    23    24    25 \n39113 39217 38941 39352 39222 46118 44949 40160 38037 35069 34901 34833 35636 \n   26    27    28    29    30    31    32    33    34    35    36    37    38 \n36362 37019 37958 38672 41723 40691 40264 39727 39311 40402 39785 38995 39477 \n   39    40    41    42    43    44    45    46    47    48    49    50    51 \n39514 40459 39076 37408 36878 36972 36648 36369 35890 37160 38386 42853 41402 \n   52    53    54    55    56    57    58    59    60    61    62    63    64 \n40349 39968 40599 42431 44494 45954 46758 46968 49492 48487 48392 48764 48227 \n   65    66    67    68    69    70    71    72    73    74    75    76    77 \n47989 47079 45289 43624 42257 41474 39241 38208 37653 37680 28975 26670 26145 \n   78    79    80    81    82    83    84    85    86    87    88    89    90 \n26013 22464 20031 17623 16608 15262 13699 12062 11056  9422  8689  6725  4593 \n   91    92    93    94    95    96  <NA> \n 1725  3900  5910 11697  4380    76     0 \n```\n:::\n\n```{.r .cell-code}\n#Crear variable de edad en grupos quinquenales\ndata<-mutate(data,AGEP2=case_when(AGEP<=4 ~ \"<4\",\n                               AGEP>=5 & AGEP<=9 ~ \"05-09\",\n                               AGEP>=10 & AGEP<=14 ~ \"10-14\",\n                               AGEP>=15 & AGEP<=19 ~ \"15-19\",\n                               AGEP>=20 & AGEP<=24 ~ \"20-24\",\n                               AGEP>=25 & AGEP<=29 ~ \"25-29\",\n                               AGEP>=30 & AGEP<=34 ~ \"30-34\",\n                               AGEP>=35 & AGEP<=39 ~ \"35-39\",\n                               AGEP>=40 & AGEP<=44 ~ \"40-44\",\n                               AGEP>=45 & AGEP<=49 ~ \"45-49\",\n                               AGEP>=50 & AGEP<=54 ~ \"50-54\",\n                               AGEP>=55 & AGEP<=59 ~ \"55-59\",\n                               AGEP>=60 & AGEP<=64 ~ \"60-64\",\n                               AGEP>=65 & AGEP<=69 ~ \"65-69\",\n                               AGEP>=70 & AGEP<=74 ~ \"70-74\",\n                               AGEP>=75 & AGEP<=79 ~ \"75-79\",\n                               AGEP>=80 & AGEP<=84 ~ \"80-84\",\n                               AGEP>=85 ~ \"85+\"))\n\n#Explorar variable de edad quinquenal\ntable(data$AGEP2, useNA = \"always\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n    <4  05-09  10-14  15-19  20-24  25-29  30-34  35-39  40-44  45-49  50-54 \n151838 171174 187866 208582 183000 185647 201716 198173 190793 184453 205171 \n 55-59  60-64  65-69  70-74  75-79  80-84    85+   <NA> \n226605 243362 226238 194256 130267  83223  80235      0 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#Explorar variable de sexo\ntable(data$SEX_label, useNA = \"always\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n Female    Male    <NA> \n1654935 1597664       0 \n```\n:::\n:::\n\n\nAdicionalmente, exploraremos las variables de estado de residencia (`ST_label`) y país de nacimiento (`POBP_label`) para incorporarlas en las pirámides de población y llevar esta herramienta gráfica a otro nivel. La primera de estas variables se utilizará tal cual se encuentra, mientras que la otra se trasformará para identificar a los orígenes nacionales con mayor presencia en Estados Unidos. Con ayuda de la función `filter()` se logró identificar a los países que han aportado más inmigrantes a los Estados Unidos, los cuales resultaron ser México, India, China y las Filipinas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Explorar variable de estado de residencia\ntable(data$ST_label, useNA = \"always\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n             Alabama/AL               Alaska/AK              Arizona/AZ \n                  49647                    6411                   73025 \n            Arkansas/AR           California/CA             Colorado/CO \n                  30050                  386061                   58131 \n         Connecticut/CT             Delaware/DE District of Columbia/DC \n                  36665                    9424                    7162 \n             Florida/FL              Georgia/GA               Hawaii/HI \n                 202883                   97104                   14959 \n               Idaho/ID             Illinois/IL              Indiana/IN \n                  17936                  126623                   68122 \n                Iowa/IA               Kansas/KS             Kentucky/KY \n                  32572                   28957                   45892 \n           Louisiana/LA                Maine/ME             Maryland/MD \n                  43663                   13883                   62853 \n       Massachusetts/MA             Michigan/MI            Minnesota/MN \n                  73108                   99040                   56636 \n         Mississippi/MS             Missouri/MO              Montana/MT \n                  28572                   62254                   10615 \n            Nebraska/NE               Nevada/NV        New Hampshire/NH \n                  19436                   30080                   13606 \n          New Jersey/NJ           New Mexico/NM             New York/NY \n                  93154                   19533                  200067 \n      North Carolina/NC         North Dakota/ND                 Ohio/OH \n                 104337                    7691                  119869 \n            Oklahoma/OK               Oregon/OR         Pennsylvania/PA \n                  37780                   42752                  129787 \n        Rhode Island/RI       South Carolina/SC         South Dakota/SD \n                  10957                   51580                    8823 \n           Tennessee/TN                Texas/TX                 Utah/UT \n                  69853                  261446                   33731 \n             Vermont/VT             Virginia/VA           Washington/WA \n                   6678                   87093                   78528 \n       West Virginia/WV            Wisconsin/WI              Wyoming/WY \n                  17428                   60281                    5861 \n                   <NA> \n                      0 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#Explorar variable de país de nacimiento\ndata%>%\n  filter(POBP>=100)%>%\n  group_by(POBP_label,POBP)%>%\n  count()%>%\n  arrange(desc(n))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 167 × 3\n# Groups:   POBP_label, POBP [167]\n   POBP_label   POBP     n\n   <chr>       <int> <int>\n 1 Mexico        303 89067\n 2 India         210 25812\n 3 China         207 23663\n 4 Philippines   233 23468\n 5 Vietnam       247 14672\n 6 Germany       110 12195\n 7 Cuba          327 11337\n 8 El Salvador   312 11233\n 9 Korea         217 11214\n10 Canada        301 10286\n# ℹ 157 more rows\n```\n:::\n:::\n\n\nCon la información anterior vamos a generar una variable que nos permita identificar el origen nacional de todos los individuos de la muestra. Esa variable la nombraremos `POBP2` y nos permitirá reducir el número de países a través de la creación de una categoría denominada `Otro`. Esta opción de respuesta incluye a todos aquellos inmigrantes que no forman parte de los orígenes nacionales con mayor presencia en los Estados Unidos. Una vez concluido este procedimiento tendremos todos los insumos necesarios para construir una pirámide de población.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Crear variable de país de nacimiento \ndata<-mutate(data,POBP2=case_when(POBP<=100~\"Estados Unidos\",\n                                  POBP==303~\"México\",\n                                  POBP==210~\"India\",\n                                  POBP==207~\"China\",\n                                  POBP==233~\"Filipinas\",\n                                  TRUE~\"Otro\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#Explorar variable d país de nacimiento agrupada\ntable(data$POBP2, useNA = \"always\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n         China Estados Unidos      Filipinas          India         México \n         23663        2820981          23468          25812          89067 \n          Otro           <NA> \n        269608              0 \n```\n:::\n:::\n\n\n# Pirámides de población en Estados Unidos\n\nAntes de trazar las pirámides de población, es importante recordar que los datos utilizados en este proyecto provienen de una encuesta, razón por la que solo son representa una muestra pequeña de la población de los Estados Unidos. Para que nuestros resultados sean más cercanos al universo poblacional, es necesario ponderar a los sujetos de la muestra para que representen al resto de individuos con las mismas o similares características. Esto se logra con las funciones `svydesign()` y `svytable()` que provienen del paquete `survey`, y otro conjunto de funciones como `group_by()` y `mutate()` que están contenidas en el paquete `tidyverse`.\n\nEl primer paso de este proceso consiste en declarar el diseño de muestra utilizando el esquema de muestreo de la encuesta, mismo que se ve reflejado en un número determinado de variables técnicas. El la `ACS` solo tenemos la variable `PWGTP` que corresponde al ponderador de la persona, por lo que será necesario configurar la función `svydesign()` de tal manera que considere esa columna como un peso individual bajo un esquema de muestreo simple. Guardaremos el diseño de la encuesta en un objeto llamado `design`, mismo que será utilizado en los pasos posteriores para ponderar la muestra.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Declarar el diseño de muestra\ndesign<-svydesign(id=~1,\n                  weights=~PWGTP,\n                  data=data)\n```\n:::\n\n\n### Pirámide general\n\nLa función `svytable()` nos ayuda a ponderar la muestra en función del diseño de encuesta, mismo que especificamos en el objeto `design`. Posteriormente, con la función `mutate()` generamos una nueva variable del porcentaje de hombres y mujeres en cada grupo quinquenal de edad. Las funciones `font_add_google()` y `showtext_auto()` del paquete `showtext` nos permiten importar tipos de letra de [Google](https://fonts.google.com/) para poder darle un mejor aspecto a nuestra pirámide. Finalmente, utilizamos la función `ggplot()` para generar una gráfica de barras invertida para cada sexo en función de la edad.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsvytable(~AGEP2+SEX_label,design = design)%>%\n  as.data.frame()%>%\n  mutate(Perc = round(Freq/sum(Freq)*100,2))->tab1\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_add_google(\"Oswald\", \"Oswald\")\nfont_add_google(\"Manrope\", \"Manrope\")\nshowtext_auto()\n\ntab1<-mutate(as.data.frame(tab1),edad_num=rep(c(1:18),times=2))\n\nage_bins<-c(\"<4\", \"05-09\", \"10-14\", \"15-19\", \"20-24\",\"25-29\",\"30-34\",\n            \"35-39\",\"40-44\",\"45-49\",\"50-54\",\"55-59\",\"60-64\",\"65-69\",\n            \"70-74\",\"75-79\",\"80-84\",\"85+\")\n\nggplot(tab1, aes(x = edad_num, fill = SEX_label,\n                 y = ifelse(test = SEX_label == \"Female\",\n                            yes = -Perc, no = Perc))) + \n  geom_bar(stat = \"identity\",color=\"gray20\") +\n  scale_y_continuous(labels = abs, breaks=c(-4,-3,-2,-1,0,1,2,3,4)) +\n  coord_flip()+ \n  scale_fill_manual(values =c(\"#F7E6D1\",\"#D77D10\"), labels=c(\"Mujer\",\"Hombre\"))+\n  scale_x_continuous(breaks = (1:18),\n                     labels = age_bins,\n                     expand = c(0, 0),\n                     sec.axis = dup_axis())+\n  labs(title = \"Estructura por edad y sexo de la población\\nen Estados Unidos\",\n       subtitle = \"American Community Survey (ACS, 2021)\",\n       caption = \"Fuente: Elaboración propia con datos anuales\\nde la American Community Survey (ACS, 2021)\", \n       fill=\"\",x=\"Grupos de edad\",y=\"Población (%)\")+\n  theme(legend.position = \"top\",\n        axis.text=element_text(family='Manrope', color=\"gray20\"),\n        axis.title=element_text(family='Manrope',color=\"gray20\"),\n        legend.text=element_text(family='Manrope',color=\"gray20\"),\n        plot.title = element_text(family=\"Oswald\",size=20,color=\"gray20\"),\n        plot.subtitle = element_text(family = \"Manrope\",size=12,color=\"gray20\"),\n        plot.caption = element_text(family = \"Manrope\",size=8,color=\"gray20\"))+\n   geom_hline(yintercept=c(-1,-2,-3,1,2,3),\n               linetype=\"dashed\", color=\"gray20\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=518.4}\n:::\n:::\n\n\nEn general, la pirámide muestra una forma de pera, situación que indica una cantidad similar de personas en los grupos de edad más jóvenes y en los grupos de edades adultas, esto mientras que se observa una disminución gradual a medida que se avanza en los grupos de edad más avanzada. En los grupos de edad más jóvenes (menores de 25 años), tanto hombres como mujeres tienen porcentajes similares, lo que indica una distribución equilibrada por sexo en esos rangos de edad. A medida que se avanza en los grupos de edad más avanzada (por encima de los 25 años), se observa una disminución en el porcentaje de hombres en comparación con las mujeres. Esto sugiere que entre las mujeres hay una mayor longevidad en comparación con los hombres.\n\n### Pirámide por país de nacimiento\n\nEn `R` es posible involucrar más variables además del sexo y la edad para construir pirámides de población a un bajo costo en términos de código y de procesamiento. La función `facet_wrap()` nos permite dividir los datos en parcelas para clasificar las pirámides en función de una variable de interés, por ejemplo, el país de nacimiento. Para realizar este procedimiento, primero vamos a emplear la función `svytable()` con el objetivo de obtener el número y porcentaje de individuos en cada grupo de edad y sexo, pero ahora incluyendo también la variable que construimos para distinguir el país de nacimiento de la persona (`POBP2`). Finalmente se utilizará el mismo código empleado para la pirámide anterior, pero ahora incluyendo la función `facet_wrap()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsvytable(~AGEP2+SEX_label+POBP2,design = design)%>%\n  as.data.frame()%>%\n  group_by(POBP2)%>%\n  mutate(Perc = round(Freq/sum(Freq)*100,2))->tab2\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_add_google(\"Oswald\", \"Oswald\")\nfont_add_google(\"Manrope\", \"Manrope\")\nshowtext_auto()\n\ntab2<-mutate(as.data.frame(tab2),edad_num=rep(c(1:18),times=12))\n\nage_bins<-c(\"<4\", \"05-09\", \"10-14\", \"15-19\", \"20-24\",\"25-29\",\"30-34\",\n            \"35-39\",\"40-44\",\"45-49\",\"50-54\",\"55-59\",\"60-64\",\"65-69\",\n            \"70-74\",\"75-79\",\"80-84\",\"85+\")\n\nggplot(tab2, aes(x = edad_num, fill = SEX_label,\n                 y = ifelse(test = SEX_label == \"Female\",\n                            yes = -Perc, no = Perc))) + \n  geom_bar(stat = \"identity\",color=\"gray20\", size=0.3) +\n  scale_y_continuous(labels = abs, breaks=c(-8,-6,-4,-2,0,2,4,6,8)) +\n  coord_flip()+ \n  scale_fill_manual(values =c(\"#F7E6D1\",\"#D77D10\"), labels=c(\"Mujer\",\"Hombre\"))+\n  scale_x_continuous(breaks = (1:18),\n                     labels = age_bins,\n                     expand = c(0, 0),\n                     sec.axis = dup_axis())+\n  labs(title = \"Estructura por edad y sexo de la población en Estados Unidos\\npor país de nacimiento\",\n       subtitle = \"American Community Survey (ACS, 2021)\",\n       caption = \"Fuente: Elaboración propia con datos anuales\\nde la American Community Survey (ACS, 2021)\", \n       fill=\"\",x=\"Grupos de edad\",y=\"Población (%)\")+\n  theme(legend.position = \"top\",\n        axis.text=element_text(family='Manrope', color=\"gray20\", size=7),\n        axis.title=element_text(family='Manrope',color=\"gray20\"),\n        legend.text=element_text(family='Manrope',color=\"gray20\"),\n        plot.title = element_text(family=\"Oswald\",size=20,color=\"gray20\"),\n        plot.subtitle = element_text(family = \"Manrope\",size=12,color=\"gray20\"),\n        plot.caption = element_text(family = \"Manrope\",size=8,color=\"gray20\"))+\n   geom_hline(yintercept=c(-2,-4,-6,-8,2,4,6,8), linetype=\"dashed\", \n              size=0.35,color=\"gray20\")+\n  facet_wrap(~POBP2)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.png){width=691.2}\n:::\n:::\n\n\nEl resultado son seis parcelas dentro de las cuales se encuentran las pirámides de población asociadas a cada uno de los orígenes nacionales de interés. La forma y la distribución de la población en cada pirámide nos permite visualizar ciertas estructuras interpretables. Por ejemplo, se puede apreciar que diferencia de la población nativa, la estructura por edad y sexo de la población migrante en los Estados Unidos muestra una tendencia regresiva con una pirámide de población en forma de rombo. En este tipo de pirámides, los grupos de edades de la base y de las puntas son más pequeños que los grupos del medio, situación que indica una mayor presencia de población en edad productiva.\n\nAl descomponer la población en Estados Unidos por país de nacimiento, se puede observar que la pirámide de los nativos es principalmente estacionaria, es decir, que las barras en cada grupo de edad son más o menos uniformes. Sin embargo, su estructura por edad y sexo es particularmente interesante porque evidencia un vació importante de población en edades productivas, mismo que muy probablemente es complementado con la presencia de la población migrante. Un punto importante de resaltar es que la población mexicana en Estados Unidos se encuentra conformada principalmente por hombres, mientras que la población filipina y china en el país se encuentra predominantemente compuesta por más mujeres que hombres.\n\n### Llevando el concepto de histograma a otro nivel\n\nEvidentemente, la creación de parcelas por medio de la función `facet_wrap()` no son tan intuitivas como se esperaría. En ocasiones las diferencias entre sexo o edad son tan pequeñas que llegan a ser imperceptibles para la vista. En función de lo anterior, es que se propone mejorar la representación de las pirámides de población utilizando un enfoque basado en capas. Al colocar una pirámide sobre la otra, es posible comparar de mejor manera las distribuciones de una y otra población en cuanto a su edad y sexo.\n\nEste ejercicio solo es posible al combinar los histogramas convencionales que constituyen una pirámide de población y el número de gráficos de lineas que sean necesarios. Para realizar dicho procedimiento utilizaremos las funciones de `ggplot()` dentro de la cual definiremos los ejes `x` y `y` del gráfico, y las funciones `geom_bar()`, `geom_line()` y `geo_point()` para determinar los tipos de gráficos a utilizar en la figura. Para su correcta construcción, utilizaremos el mismo código utilizado con anterioridad, solo que ahora agregaremos lineas y puntos superpuestos a las barras.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsvytable(~AGEP2+SEX_label+POBP2,design = design)%>%\n  as.data.frame()%>%\n  group_by(POBP2)%>%\n  mutate(Perc = round(Freq/sum(Freq)*100,2))%>%\n  filter(POBP2!=\"Otro\")->tab3\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_add_google(\"Oswald\", \"Oswald\")\nfont_add_google(\"Manrope\", \"Manrope\")\nshowtext_auto()\n\ntab3<-mutate(as.data.frame(tab3),edad_num=rep(c(1:18),times=10))\n\nage_bins<-c(\"<4\", \"05-09\", \"10-14\", \"15-19\", \"20-24\",\"25-29\",\"30-34\",\n            \"35-39\",\"40-44\",\"45-49\",\"50-54\",\"55-59\",\"60-64\",\"65-69\",\n            \"70-74\",\"75-79\",\"80-84\",\"85+\")\n\n\nggplot(data = subset(tab3,POBP2!=\"Estados Unidos\"),\n       mapping = aes(x = edad_num, y = ifelse(test = SEX_label == \"Female\",\n                                              yes = -Perc, no = Perc),\n                     color = POBP2,fill=SEX_label)) +\n  geom_bar(data=subset(tab3,POBP2==\"Estados Unidos\"),\n           stat = \"identity\",color=\"gray20\" )+\n  geom_line(size=0.8)+\n  geom_point(size=3,aes(color=POBP2))+\n  coord_flip(clip = \"off\")+\n  scale_x_continuous(breaks = (1:18),\n                     labels = age_bins,\n                     expand = c(0, 0),\n                     sec.axis = dup_axis())+\n  scale_y_continuous(labels = abs, breaks=c(-8,-6,-4,-2,0,2,4,6,8),\n                     limits = c(-9,9))+\n    scale_color_brewer(palette = \"YlOrBr\")+\n    scale_fill_manual(values =c(\"#F7E6D1\",\"#D77D10\"))+\n  theme(legend.position=\"bottom\",\n          text = element_text(size = 17))+\n  annotate(geom = \"text\", x = 1.8, y = -28.5, size=5,\n           label = \"Hombres\", hjust = \"left\")+\n  annotate(geom = \"text\", x = 1.8, y = 22.5, size=5,\n           label = \"Mujeres\", hjust = \"left\")+\n  guides(fill=F)+\n  labs(x=\"Grupos de edad\",y=\"Población (%)\",color = \"\", shape = \"\")+\n  labs(title = \"Contribución de la población migrante a la\\nestructura por edad y sexo de la población\\nen Estados Unidos\",\n       subtitle = \"American Community Survey (ACS, 2021)\",\n       caption = \"Fuente: Elaboración propia con datos anuales\\nde la American Community Survey (ACS, 2021)\", \n       fill=\"\",x=\"Grupos de edad\",y=\"Población (%)\")+\n  theme(legend.position = \"top\",\n        axis.text=element_text(family='Manrope', color=\"gray20\",size=9),\n        axis.title=element_text(family='Manrope',color=\"gray20\",size=11),\n        legend.text=element_text(family='Manrope',color=\"gray20\", size=12),\n        plot.title = element_text(family=\"Oswald\",size=20,color=\"gray20\"),\n        plot.subtitle = element_text(family = \"Manrope\",size=12,color=\"gray20\"),\n        plot.caption = element_text(family = \"Manrope\",size=8,color=\"gray20\"))+\n   geom_hline(yintercept=c(-2,-4,-6,-8,2,4,6,8), linetype=\"dashed\", \n              size=0.35,color=\"gray20\")+\n    annotate(geom = \"text\", x = 3, y = -8.5, size=4,\n           label = \"Mujeres\", hjust = \"left\")+\n  annotate(geom = \"text\", x = 3, y = 5, size=4,\n           label = \"Hombres\", hjust = \"left\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-19-1.png){width=518.4}\n:::\n:::\n\n\nEl código anterior nos proporciona una pirámide de población en la cual es posible apreciar las estructura por edad y sexo, pero considerando el país de nacimiento de la población en Estados Unidos. En las barras es posible observar la distribución porcentual de las personas que nacieron en Estados Unidos, mientras que las lineas con puntos se explica la distribución porcentual de la población migrante. Cabe mencionar que, cada uno de los distintos orígenes nacionales contribuyen de manera diferenciada a la estructura de la población en Estados Unidos, por ejemplo, complementando los vacíos que existen en algunos grupos de edad considerados productivos y reproductivos.\n\nPor un lado, se encuentran los mexicanos que aportan más al quinquenio de 45-49 años, mientras que los indios aportan de sobremanera al grupo de 35-39 años. Por su parte, los chinos tienen una mayor contribución en el quinquenio 30-34, mientras que los filipinos aportan más en edades avanzadas que van desde los 50 a los 69 años. Esto también nos permite reconoce cuáles estructuras poblacionales son más longevas (provenientes de las Filipnas) y cuáles son más jóvenes (provenientes de India, China y México). En la imagen se puede apreciar la complementariedad demográfica de la cual se ha hablado.\n\n# Conclusiones\n\nLas pirámides de población son herramientas gráficas muy potentes que nos permiten observar la estructura por edad y sexo de las poblaciones. La forma en la que se pueden utilizar las pirámides son muy variadas y enriquecedoras, pero su determinación siempre estará encaminada a visualizar la distribución de las personas según su sexo, su edad y otras variables opcionales, por ejemplo, el país de nacimiento.\n\nLos resultados del análisis de datos de este ejercicio revelan que existen patrones significativos en la estructura de la pirámide de población y la distribución por edad y sexo en relación con diferentes grupos demográficos en los Estados Unidos. Estos hallazgos demográficos son de gran importancia para comprender las dinámicas poblacionales y sus implicaciones sociales y económicas.\n\nLa composición de la población en Estados Unidos se caracteriza por una distribución equilibrada de personas nativas en las edades más jóvenes y más lonjevas, con un vació en las edades adultas. Esta población muestra con una tendencia al envejecimiento que muy probablemente se complementa con una mayor presencia de migrantes en edades productivas y reproductivas que nos permiten entender la importancia de considerar factores como la edad y el sexo al analizar los patrones poblacionales.\n\n::: {.callout-note title=\"¿Cómo citar este *post*?\"}\n\n## ¿Cómo citar este post?\nReyes-Vázquez, F. (31 de mayo del 2023). Pirámides de población en R-Studio para entender la estructura por edad y sexo de la poblacion migrante en los Estados Unidos (2021). Mi Blog. https://www.bibguru.com/es/g/cita-apa-publicacion-de-blog/\n:::\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}